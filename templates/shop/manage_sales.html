{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vender | Missão Andrews</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'shop/styles.css' %}">
</head>
<body
    data-create-sale-url="{% url 'manage_sales_create_order' %}"
    data-mark-paid-template="{% url 'manage_sales_mark_paid' 0 %}"
    data-checkout-status-template="{% url 'checkout_status' 0 %}"
>
    <header class="manage-header">
        <h1>Vendas no balcão</h1>
        <div class="manage-header-actions">
            <a class="secondary-button link-button" href="{% url 'manage_products_page' %}">Voltar ao painel</a>
        </div>
    </header>

    <main class="manage-page sales-page">
        <section class="section-card">
            <p class="panel-subtitle">Produtos para venda</p>
            <div class="products-grid sales-grid">
                {% for product in products %}
                    <article class="product-card sales-product" data-product-id="{{ product.id }}" data-product-name="{{ product.name|escape }}">
                        <img src="{{ product.image_source }}" alt="{{ product.name }}">
                        <div class="content">
                            <h2>{{ product.name }}</h2>
                            <p>{{ product.description }}</p>
                            <strong class="product-price" data-base-price="{{ product.price }}">R$ {{ product.price }}</strong>
                            {% if product.active_variants %}
                                <select class="variant-select">
                                    <option value="">Sem variação</option>
                                    {% for variant in product.active_variants %}
                                        <option value="{{ variant.id }}" data-name="{{ variant.name }}" data-price="{{ variant.price }}">
                                            {{ variant.name }} - R$ {{ variant.price }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% endif %}
                            <div class="qty-control">
                                <button type="button" class="qty-btn" data-action="minus">-</button>
                                <input type="number" min="1" value="1" class="qty-input">
                                <button type="button" class="qty-btn" data-action="plus">+</button>
                            </div>
                            <button class="add-btn add-sale-item-btn" type="button">Adicionar</button>
                        </div>
                    </article>
                {% empty %}
                    <p>Nenhum produto ativo para vender.</p>
                {% endfor %}
            </div>
        </section>

        <section class="section-card sales-summary-card">
            <p class="panel-subtitle">Carrinho da venda</p>
            <div id="sale-cart-items" class="sidebar-items"></div>
            <p>Total: <strong id="sale-cart-total">R$ 0.00</strong></p>

            <form id="sale-form" class="checkout-form">
                {% csrf_token %}
                <input type="text" name="customer_name" placeholder="Nome completo" required>
                <input type="text" name="whatsapp" placeholder="WhatsApp" required>
                <select name="payment_method" id="sale-payment-method" required>
                    <option value="">Forma de pagamento</option>
                    <option value="pix">Pix</option>
                    <option value="card">Cartão</option>
                    <option value="cash">Dinheiro</option>
                </select>
                <label class="checkbox-line" id="mark-paid-wrapper">
                    <input type="checkbox" name="mark_paid_now">
                    Marcar como pago agora
                </label>
                <button class="add-btn" type="submit">Finalizar venda</button>
            </form>
        </section>
    </main>

    <div id="sale-modal-overlay" class="payment-modal-overlay" hidden></div>
    <section id="sale-modal" class="payment-modal" hidden>
        <button id="close-sale-modal" class="payment-close-btn" type="button">X</button>
        <h3 id="sale-modal-title">Venda criada</h3>
        <p id="sale-modal-message"></p>
        <p id="sale-modal-status" class="cart-meta"></p>
        <img id="sale-modal-qr" alt="QR Code Pix" hidden>
        <button id="sale-copy-pix" class="add-btn" type="button" hidden>Copiar código Pix</button>
        <button id="sale-mark-paid-btn" class="secondary-button" type="button" hidden>Marcar como pago</button>
    </section>

    <script src="{% static 'shop/manage_sales.js' %}"></script>
</body>
</html>
